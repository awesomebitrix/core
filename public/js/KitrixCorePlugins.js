// Generated by CoffeeScript 1.12.2
(function() {
  var KitrixCorePlugins;

  $(function() {
    return window.KitrixCorePlugins = new KitrixCorePlugins();
  });

  KitrixCorePlugins = (function() {
    KitrixCorePlugins.params = null;

    function KitrixCorePlugins() {
      if (typeof KitrixCorePluginsParams !== "undefined" && KitrixCorePluginsParams !== null) {
        this.params = KitrixCorePluginsParams;
      }
      return;
    }


    /*
      Enable plugin by ID
      @param id - PID of plugin (kitrix/core)
     */

    KitrixCorePlugins.prototype.enable = function(id) {
      var plugin;
      plugin = this.params.plugins[id];
      this.sRequest('enable', {
        pid: id
      }, function(isSuccess, response) {
        if (isSuccess) {
          alertify.success("Плагин " + plugin.title + " включен!");
        }
      });
    };


    /*
      Disable plugin by ID
      @param id - PID of plugin (kitrix/core)
     */

    KitrixCorePlugins.prototype.disable = function(id) {
      var plugin;
      plugin = this.params.plugins[id];
      alertify.confirm("Вы действительно хотите выключить плагин " + plugin.title + "? Вы сможете включить его позже, все данные/файлы созданные плагином останутся. Если вы использовали API плагина, оно станет недоступно.", (function(_this) {
        return function() {
          return _this.sRequest('disable', {
            pid: id
          }, function(isSuccess, response) {
            if (isSuccess) {
              alertify.success("Плагин " + plugin.title + " отключен!");
            }
          });
        };
      })(this));
    };


    /*
      Uninstall plugin
      @param id - PID of plugin (kitrix/core)
     */

    KitrixCorePlugins.prototype.uninstall = function(id) {
      var plugin;
      plugin = this.params.plugins[id];
      alertify.confirm("Вы действительно хотите ДЕИНСТАЛИРОВАТЬ плагин " + plugin.title + "? Физически плагин останется в системе, но вся информация об этом плагине будет очищена (все данные будут стерты, кеш очищен, файлы и компоненты созданные плагином будут удалены). При этом ВЫ МОЖЕТЕ ЗАНОВО УСТАНОВИТЬ плагин позже.", (function(_this) {
        return function() {
          return _this.sRequest('uninstall', {
            pid: id
          }, function(isSuccess, response) {
            if (isSuccess) {
              alertify.success("Плагин " + plugin.title + " деинсталирован!");
            }
          });
        };
      })(this));
    };


    /*
      Install plugin
      @param id - PID of plugin (kitrix/core)
     */

    KitrixCorePlugins.prototype.install = function(id) {
      var plugin;
      plugin = this.params.plugins[id];
      return this.sRequest('install', {
        pid: id
      }, function(isSuccess, response) {
        if (isSuccess) {
          alertify.success("Плагин " + plugin.title + " установлен!");
        }
      });
    };

    KitrixCorePlugins.prototype.sRequest = function(action, data, callback) {
      var checkResponseClosure;
      if (data == null) {
        data = {};
      }
      if (callback == null) {
        callback = null;
      }
      checkResponseClosure = function(success, r) {
        if (success == null) {
          success = false;
        }
        console.log(r, r.msg);
        if ((r != null) && (r.error != null)) {
          alertify.error(r.msg);
        }
        callback(success, r);
      };
      $.ajax({
        url: this.params.url,
        data: $.extend({
          action: action
        }, data),
        success: function(r) {
          return checkResponseClosure(true, JSON.parse(r));
        },
        error: function(r) {
          return checkResponseClosure(false, JSON.parse(r.responseText));
        }
      });
    };

    return KitrixCorePlugins;

  })();

}).call(this);
